---
title: "gitã§GPGç½²åä»˜ãã‚³ãƒŸãƒƒãƒˆã‚’å¿˜ã‚ŒãŸæ™‚"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [git]
published: true
---

## èƒŒæ™¯

ç§ã¯å¯èƒ½ãªé™ã‚Šé–‹ç™ºçŠ¶æ³ã«ãŠã„ã¦ã‚³ãƒŸãƒƒãƒˆã¯GPGç½²åä»˜ãã«ã¦è¡Œã£ã¦ã„ã¾ã™ãŒã€è‡ªåˆ†ã®æ–°ã—ã„PCç’°å¢ƒã‚„ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã§ç›´æ¥é–‹ç™ºã‚’è¡Œã„ã‚³ãƒŸãƒƒãƒˆã‚’ã™ã‚‹éš›ã«ã€GPGã®è¨­å®šã‚’ã™ã‚‹ã®ã‚’å¿˜ã‚Œã¦ã„ãŸã‚Šã™ã‚‹ã¨é–‹ç™ºã®æ‰‹ãŒæ­¢ã¾ã£ã¦ã—ã¾ã„ã€éå¸¸ã«å«Œãªæ€ã„ã‚’ã—ã¾ã™ã€‚

ãã“ã§ä»Šå›ã¯ãã‚“ãªæ™‚ã«ã€å¾Œã‹ã‚‰ã§ã‚‚ç½²åã‚’è¿½åŠ ã§ãã‚‹ã‚³ãƒŸãƒƒãƒˆã®ç·¨é›†æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## TL;DR

1. `git rebase -i {ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ä¸€ã¤æ‰‹å‰ã®ã‚³ãƒŸãƒƒãƒˆID}`
2. ã‚¨ãƒ‡ã‚£ã‚¿ãŒç«‹ã¡ä¸ŠãŒã‚Šã€1ã§æŒ‡å®šã—ãŸã‚³ãƒŸãƒƒãƒˆIDã¾ã§ã®å±¥æ­´ãŒä¸€è¦§ã¨ã—ã¦ç«‹ã¡ä¸ŠãŒã‚‹ã®ã§ã€GPGç½²åã‚’è¿½åŠ ã—ãŸã„ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã‚³ãƒŸãƒƒãƒˆï¼ˆã‚‚ã—ãã¯è¤‡æ•°ï¼‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’`pick`ã‹ã‚‰`edit`ã¸ã¨å¤‰æ›´ã—ã€ä¿å­˜ã™ã‚‹
3. `git commit --amend --no-edit -S`
4. `git rebase --continue`

## ç½²åã®ç¢ºèª

ã¾ãšæœ€åˆã«ã€ç½²åãŒç¢ºèªã•ã‚Œã¦ã„ã‚‹ã®ã‹ã©ã†ã‹ã®ç¢ºèªã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã‚³ãƒãƒ³ãƒ‰ã¯`git log --show-signature`ã§ç¢ºèªãŒå¯èƒ½ã§ã™ã€‚

```bash
kazuaki@yeezy:~/fun/zenn.dev$ git log --show-signature
commit 63b4a857462ee7f29eb81fc2118a5e9acd831138 (HEAD -> master)
Author: Kazuaki Ishiguro <kazuakiishiguro@protonmail.com>
Date:   Sun Oct 17 21:01:49 2021 +0900

    added zenn-cli

commit f41e5df5c31db4b3df7561447242038c0b677ea8 (origin/master)
gpg: Signature made Mon 06 Sep 2021 10:19:01 AM JST
gpg:                using EDDSA key ...BECD98A8A99831
gpg: Good signature from "Kazuaki Ishiguro <kazuakiishiguro@protonmail.com>" [ultimate]
Author: Kazuaki Ishiguro <kazuakiishiguro@protonmail.com>
Date:   Mon Sep 6 10:19:01 2021 +0900

    Initial setup
```

ä¸Šè¨˜ã®ãƒ­ã‚°ã‹ã‚‰ã€ã‚³ãƒŸãƒƒãƒˆID`63b4a857462ee7f29eb81fc2118a5e9acd831138`ãŒAuthorã¨Dateã€ãã—ã¦ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã—ã‹è¨˜è¼‰ã•ã‚Œã¦ã„ãªã„ã®ã«å¯¾ã—ã¦ã€ã‚³ãƒŸãƒƒãƒˆID`f41e5df5c31db4b3df7561447242038c0b677ea8`ã¯gpgã§ã®ç½²åæƒ…å ±ãŒè¨˜è¼‰ã•ã‚Œã¦ãŠã‚Šã€ç›´è¿‘ã®ã‚³ãƒŸãƒƒãƒˆã«ç½²åãŒã•ã‚Œã¦ã„ãªã„äº‹ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

## ã‚³ãƒŸãƒƒãƒˆã®ç·¨é›†

ã§ã¯æ—©é€Ÿã‚³ãƒŸãƒƒãƒˆã‚’ç·¨é›†ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®æŒ‡å®š

ä½¿ã†ã‚³ãƒãƒ³ãƒ‰ã¯`git rebase`ã«ãªã‚Šã¾ã™ã€‚

`git rebase`ã§ã®ã‚³ãƒŸãƒƒãƒˆã®ç·¨é›†ã¯ã‹ã‚‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ãªã‚‹ã‚³ãƒŸãƒƒãƒˆIDã®ä¸€ã¤å‰ã®ã‚³ãƒŸãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»Šå›ã®ä¾‹ã§ã™ã¨`f41e5df5c31db4b3df7561447242038c0b677ea8`ã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash
kazuaki@yeezy:~/fun/zenn.dev$ git rebase -i f41e5df5c31db4b3df7561447242038c0b677ea8

# ä»¥ä¸‹ã‚¨ãƒ‡ã‚£ã‚¿å†…ã§ã®è¡¨ç¤º

pick 63b4a85 added zenn-cli

# Rebase f41e5df..63b4a85 onto f41e5df (1 command)
#
# Commands:
......
```

`rebase`ã®æŒ™å‹•ã«ã¤ã„ã¦ã‚ˆã‚Šè©³ã—ãçŸ¥ã‚ŠãŸã„ã¨ã„ã†äººã¯å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹äº‹ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

* [git rebase](https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E6%A9%9F%E8%83%BD-%E3%83%AA%E3%83%99%E3%83%BC%E3%82%B9)

### ç·¨é›†ã—ãŸã„ã‚³ãƒŸãƒƒãƒˆIDã®å·¦ã«ã‚ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å¤‰æ›´ï¼ˆ`pick` -> `edit`ï¼‰ã—ã€ä¿å­˜ã™ã‚‹

ä¸Šè¨˜ã®ä¾‹ã§ã™ã¨ã€ä»¥ä¸‹ã®æ§˜ã«å¤‰æ›´ã—ã¾ã™ã€‚

```bash
# ä»¥ä¸‹ã‚¨ãƒ‡ã‚£ã‚¿å†…ã§ã®è¡¨ç¤º

edit 63b4a85 added zenn-cli

# Rebase f41e5df..63b4a85 onto f41e5df (1 command)
#
# Commands:
```

ä¸Šè¨˜ã®çŠ¶æ…‹ã§ä¿å­˜ã™ã‚‹ã¨ã‚¨ãƒ‡ã‚£ã‚¿ãŒçµ‚äº†ã—ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ç”»é¢ã¸ã¨æˆ»ã£ã¦ãã¾ã™ã€‚

æˆ»ã£ã¦ãã‚‹ã¨ä»¥ä¸‹ã®æ§˜ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

```bash
kazuaki@yeezy:~/fun/zenn.dev$ git rebase -i f41e5df5c31db4b3df7561447242038c0b677ea8
Stopped at 63b4a85...  added zenn-cli
You can amend the commit now, with

  git commit --amend

Once you are satisfied with your changes, run

  git rebase --continue
```

### ç½²åã‚’è¿½åŠ 

ã‚¹ãƒ†ãƒƒãƒ—ï¼’ã§ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã‚³ãƒŸãƒƒãƒˆãŒç·¨é›†ãŒå¯èƒ½ãªçŠ¶æ…‹ã¨ãªã‚Šã¾ã—ãŸã€‚

è¦ªåˆ‡ãªäº‹ã«ã‚‚å¿…è¦ãªã‚³ãƒãƒ³ãƒ‰ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã®ã§ã€ãã‚Œã«æ²¿ã£ã¦æ®‹ã‚Šã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã‘ã°çµ‚äº†ã§ã™ã€‚

ã¨ã¯è¨€ãˆã€ä»Šå›ã¯ç½²åã‚’è¿½åŠ ã™ã‚‹ã®ã¿ã®ç·¨é›†ã‚’ã™ã‚‹äº‹ãŒç›®çš„ãªã®ã§ã€`--no-edit`ã¨`-S`ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

ã‚³ãƒãƒ³ãƒ‰ã®è©³ç´°ã¯ä»¥ä¸‹ã§ã™ã€‚

* `--amend` å‰ã®ã‚³ãƒŸãƒƒãƒˆã‚’ä¿®æ­£ã€‚
* `--no-edit` æ—¢å­˜ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã€‚
* `-S` GPGç½²åã‚’æŒ‡å®šã€‚

ã“ã¡ã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```bash
kazuaki@yeezy:~/fun/zenn.dev$ git commit --amend --no-edit -S
[detached HEAD 2fb6f5e] added zenn-cli
 Date: Sun Oct 17 21:01:49 2021 +0900
 2 files changed, 909 insertions(+), 896 deletions(-)
 rewrite yarn.lock (96%)
```

### ç·¨é›†ã‚’çµ‚äº†

`HEAD`ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€æœ€å¾Œã«rebaseã‚’ç¶šè¡Œã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³`--continue`ã‚’æŒ‡å®šã—ã¦ç·¨é›†ã‚’çµ‚äº†ã—ã¾ã™ã€‚

```bash
kazuaki@yeezy:~/fun/zenn.dev$ git rebase --continue
Successfully rebased and updated refs/heads/master.
```

## ç½²åã®å†ç¢ºèª

ãã‚Œã§ã¯å•é¡Œãªãç·¨é›†ãŒã§ãã¦ã‚‹ã®ã‹ç¢ºèªã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
æœ€åˆã¨åŒæ§˜ã«`git log --show-signature`ã‚’å©ãã¾ã™ã€‚

```bash
kazuaki@yeezy:~/fun/zenn.dev$ git log --show-signature
commit 2fb6f5e4ef43928ae465bf904efcfd3d98a0d45e (HEAD -> master)
gpg: Signature made Sun 17 Oct 2021 09:33:28 PM JST
gpg:                using EDDSA key ...BECD98A8A99831
gpg: Good signature from "Kazuaki Ishiguro <kazuakiishiguro@protonmail.com>" [ultimate]
Author: Kazuaki Ishiguro <kazuakiishiguro@protonmail.com>
Date:   Sun Oct 17 21:01:49 2021 +0900

    added zenn-cli

commit f41e5df5c31db4b3df7561447242038c0b677ea8 (origin/master)
gpg: Signature made Mon 06 Sep 2021 10:19:01 AM JST
gpg:                using EDDSA key ...BECD98A8A99831
gpg: Good signature from "Kazuaki Ishiguro <kazuakiishiguro@protonmail.com>" [ultimate]
Author: Kazuaki Ishiguro <kazuakiishiguro@protonmail.com>
Date:   Mon Sep 6 10:19:01 2021 +0900

    Initial setup
```

æ­£å¸¸ã«ã‚³ãƒŸãƒƒãƒˆã‚’ç·¨é›†ã—ã¦GPGç½²åã‚’è¿½åŠ ã™ã‚‹äº‹ãŒã§ãã¾ã—ãŸã€‚
åŒæ§˜ã®å•é¡Œã«æ‚©ã‚“ã§ã„ãŸäººã®ç‚ºã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚